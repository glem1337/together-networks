{"version":3,"sources":["global-script.js","main-page.js","form-login.js","form.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"script.min.js","sourcesContent":["/*\n  Поиск ближайшего родителя по селектору\n  https://github.com/oneuijs/You-Dont-Need-jQuery/blob/master/README-ru.md#1.6\n*/\n\nfunction closest(el, selector) {\n  const matchesSelector = el.matches || el.webkitMatchesSelector || el.mozMatchesSelector || el.msMatchesSelector;\n\n  while (el) {\n    if (matchesSelector.call(el, selector)) {\n      return el;\n    } else {\n      el = el.parentElement;\n    }\n  }\n  return null;\n}\n\n\n/*\n  Запуск по готовности DOM\n  http://youmightnotneedjquery.com/#ready\n  Применение: ready(function(){ console.log('ddd'); });\n*/\n\nfunction ready(fn) {\n  if (document.readyState != 'loading') {\n    fn();\n  } else {\n    document.addEventListener('DOMContentLoaded', fn);\n  }\n}\n\n\n/*\n  При добавлении новых дополнительных функций, изолируйте их!\n*/\n\n// (function(){\n//   // код\n// }());\n\n\n// Свой код с jQuery\n\n// $( document ).ready(function() {\n\n// });\n","let CustomSelect = function (select) {\n\n  this.select = select;\n  this.nodeOption = this.select.find('option');\n  this.wrapper = $('<div/>', {class: 'custom-select-wrapper'});\n  this.customSelect = $('<div/>', {class: 'custom-select'});\n  this.trigger = $('<div/>', {class: 'custom-select__trigger'});\n  this.options = $('<div/>', {class: 'custom-select__options'});\n  this.optionsInner = $('<div/>', {class: 'custom-select__options-inner'});\n  this.placeholder = this.select.data('placeholder');\n\n\n  this.trigger.on('click', this.handleTrigger.bind(this));\n  $(document).mouseup(this.handleClickDocument.bind(this));\n\n\n  this.createCustomSelect();\n};\n\nCustomSelect.prototype = {\n\n  createCustomSelect: function () {\n\n    this.select.wrap(this.wrapper);\n    this.customSelect.append(this.trigger.text(this.placeholder));\n\n    this.nodeWrap = this.select.parent('.custom-select-wrapper');\n\n    this.nodeOption.each(function (index, elem) {\n      let option = '<div class=\"custom-select__option\" data-value=\"' + $(elem).attr('value') + '\">' + $(elem).text() + '</div>';\n      this.optionsInner.append(option);\n    }.bind(this));\n\n    this.options.append(this.optionsInner);\n    this.customSelect.append(this.options);\n    this.option = this.customSelect.find('.custom-select__option');\n\n    this.option.on('click', this.handleOption.bind(this));\n\n    this.select.after(this.customSelect);\n  },\n\n  handleTrigger: function () {\n    if (this.trigger.hasClass('is-active')) {\n      this.close();\n    } else {\n      this.show();\n    }\n  },\n\n  close: function () {\n    this.trigger.removeClass('is-active');\n    this.options.hide();\n  },\n\n  show: function () {\n    this.trigger.addClass('is-active');\n    this.options.show();\n  },\n\n  handleOption: function (e) {\n    this.select.val($(e.target).data('value'));\n    this.trigger.text($(e.target).text());\n    this.handleTrigger();\n  },\n\n  handleClickDocument: function (e) {\n    if (!this.nodeWrap.is(e.target)\n      && this.nodeWrap.has(e.target).length === 0) {\n      this.close();\n    }\n  },\n\n\n};\n\n$('.select').each(function (index, elem) {\n  new CustomSelect($(elem));\n});\n\n\n\n\n\n\n\n\n\n","$('.button-login').on('click', function () {\n  $(this).hide();\n  $('#login').addClass('is-active');\n});\n\n$(document).mouseup(function (e) {\n  let form = $('#login');\n  if (!form.is(e.target)\n    && form.has(e.target).length === 0) {\n    form.removeClass('is-active');\n    $('.button-login').show();\n  }\n});\n","let StepForm = function (form) {\n\n  this.form = form;\n  this.prevStepBtn = this.form.find('#prev');\n  this.nextStepBtn = this.form.find('#next');\n  this.submitBtn = this.form.find('#submit');\n  this.currentStep = 0;\n  this.nodeStep = this.form.find('.form__fieldset');\n  this.nodeProgressItems = this.form.find('#progress li');\n  this.totalSteps = this.nodeStep.length - 1;\n\n  this.init();\n};\n\nStepForm.prototype = {\n\n  init: function () {\n    this.showStep(this.currentStep);\n    this.prevStepBtn.on('click', this.handlePrev.bind(this));\n    this.nextStepBtn.on('click', this.handleNext.bind(this));\n    this.nodeProgressItems.on('click', this.handlePoint.bind(this));\n    this.form.submit(this.handleSubmit.bind(this));\n  },\n\n  formSend: function (formData) {\n    // Таким способом только из-за поддержки IE и без дополнительных полифилов :(\n    const xhr = new XMLHttpRequest();\n    xhr.open('POST', 'http://www.mocky.io/v2/5dfcef48310000ee0ed2c281', true);\n    xhr.send(formData);\n    xhr.addEventListener('readystatechange', function (e) {\n      if (xhr.readyState !== 4) return;\n      if (xhr.status === 200) {\n        let response = JSON.parse(xhr.response)\n        if (response.status === 'error') {\n          this.errorsParse(response.errors);\n          this.toggleSubmitBtn();\n        } else {\n          alert('Registration success');\n        }\n      }\n    }.bind(this));\n  },\n\n  setError: function (name, message) {\n    this.form\n      .find('[data-error=' + name + ']')\n      .addClass('is-active')\n      .text(message);\n  },\n\n  errorsParse: function (errors) {\n    let firstErrorName = errors[0].name;\n    let firstErrorIndex = this.form\n      .find('[data-error=' + firstErrorName + ']')\n      .index();\n    errors.forEach(function (item) {\n      this.setError(item.name, item.message)\n    }.bind(this));\n    this.showStep(firstErrorIndex);\n  },\n\n  clearErrors: function () {\n    this.form\n      .find('.form__error')\n      .removeClass('is-active');\n  },\n\n  toggleSubmitBtn: function () {\n    if (this.submitBtn.hasClass('in-process')) {\n      this.submitBtn.text('Start now');\n      this.submitBtn.removeClass('in-process');\n    } else {\n      this.submitBtn.text('Sending');\n      this.submitBtn.addClass('in-process');\n    }\n  },\n\n  handleSubmit: function (e) {\n    e.preventDefault();\n    this.clearErrors();\n    this.recalculateHeightForStep(this.totalSteps);\n    let data = this.form.serializeArray();\n    this.toggleSubmitBtn();\n    // Синтетическая задержка\n    setTimeout(this.formSend.bind(this, data), 2000);\n    return false;\n  },\n\n  recalculateHeightForStep: function (step) {\n    let stepHeight = this.nodeStep.eq(step).outerHeight();\n    this.setFormHeight(stepHeight);\n  },\n\n  hideToggleButtons: function (step) {\n    if (this.totalSteps === step) {\n      this.submitBtn.show();\n      this.nextStepBtn.hide();\n    } else {\n      this.submitBtn.hide();\n      this.nextStepBtn.show();\n    }\n\n    if (step === 0) {\n      this.prevStepBtn.hide();\n    } else {\n      this.prevStepBtn.show();\n    }\n  },\n\n  showStep: function (step) {\n    if (this.totalSteps >= step && step >= 0) {\n\n      this.setCurrentStep(step);\n      this.nodeStep.removeClass('is-active');\n      this.nodeStep\n        .eq(step)\n        .addClass('is-active');\n\n      this.hideToggleButtons(step);\n\n      this.recalculateHeightForStep(step);\n      this.setProgress(step);\n    }\n\n  },\n\n  setProgress: function (step) {\n    this.nodeProgressItems.removeClass('is-active');\n    this.nodeProgressItems.each(function (index, elem) {\n      if (index <= step) {\n        $(elem).addClass('is-active');\n      }\n    });\n  },\n\n  setFormHeight: function (height) {\n    this.form.height(height);\n  },\n\n  setCurrentStep: function (step) {\n    this.currentStep = step;\n  },\n\n  handlePoint: function (e) {\n    let step = $(e.target).index();\n    this.showStep(step);\n  },\n\n  handlePrev: function () {\n    this.showStep(this.currentStep - 1);\n  },\n\n  handleNext: function () {\n    this.showStep(this.currentStep + 1);\n  },\n\n};\n\n\nnew StepForm($('#form'));\n"]}